<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>AE Upsell</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="shortcut icon" type="image/png" href="assets/images/icon/favicon.ico" />
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/font-awesome.min.css" />
  <link rel="stylesheet" href="assets/css/themify-icons.css" />
  <link rel="stylesheet" href="assets/css/metisMenu.css" />
  <link rel="stylesheet" href="assets/css/slicknav.min.css" />
  <link rel="stylesheet" href="assets/css/jquery.toast.min.css" />
  <!-- others css -->
  <link rel="stylesheet" href="assets/css/typography.css" />
  <link rel="stylesheet" href="assets/css/default-css.css" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link rel="stylesheet" href="assets/css/responsive.css" />
  <link rel="stylesheet" href="assets/css/bootstrap-datepicker3.standalone.min.css" />
  <!-- modernizr css -->
  <script src="assets/js/vendor/modernizr-2.8.3.min.js"></script>
</head>

<body>
  <!--[if lt IE 8]>
      <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
  <!-- preloader area start -->
  <div id="preloader">
    <div class="loader"></div>
  </div>
  <!-- preloader area end -->
  <!-- page container area start -->
  <div class="page-container">
    <!-- sidebar menu area start -->
    <div class="sidebar-menu">
      <div class="sidebar-header">
        <a class="navbar-brand" href="/eccctools">
          <span><i class="wi wi-sunset"></i> EC<sup>3</sup> Tools</span>
        </a>
      </div>
      <div class="main-menu">
        <div class="menu-inner">
          <nav>
            <ul class="metismenu" id="menu">
              <li class="active">
                <a href="javascript:void(0)" aria-expanded="true"><i class="ti-desktop"></i><span>PureCloud Utilities</span></a>
                <ul class="collapse">
                  <li><a href="pureclean.html">PureClean</a></li>
                  <li class="active bg-secondary"><a href="aeupsell.html">AE Upsell</a></li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
    <!-- sidebar menu area end -->
    <!-- main content area start -->
    <div class="main-content">
      <!-- header area start -->
      <div class="header-area">
        <div class="row align-items-center">
          <!-- nav and search button -->
          <div class="col-md-6 col-sm-8 clearfix">
            <div class="nav-btn pull-left">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
          <!-- profile info & task notification -->
          <div class="col-md-6 col-sm-4 clearfix">
            <ul class="notification-area pull-right">
              <li id="full-view"><i class="ti-fullscreen"></i></li>
              <li id="full-view-exit"><i class="ti-zoom-out"></i></li>
            </ul>
          </div>
        </div>
      </div>
      <!-- header area end -->
      <!-- page title area start -->
      <div class="page-title-area">
        <div class="row align-items-center">
          <div class="col-sm-6">
            <div class="breadcrumbs-area clearfix">
              <h4 class="page-title pull-left">AE Upsell</h4>
              <ul class="breadcrumbs pull-left">
                <li><a href="index.html">Home</a></li>
                <li><span class="active">AE Upsell</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- page title area end -->
      <div class="main-content-inner">
        <div class="mt-5 mb-5 card card-bordered">
          <div class="card-body text-center">
            <p>Get insightful statistics about any PureCloud organization</p>
            <p>Useful to check if PureCloud customers are using specific features or functionalities</p>
          </div>
        </div>
        <div class="mt-5 mb-5 card card-bordered">
          <div class="card-body">
            <form id="connectionform">
              <h4 class="header-title">PureCloud Connection</h4>
              <span class="form-text text-muted">Populate all fields below then click on <code>Submit Request</code></span><br />
              <div class="form-group">
                <label for="orgId">Org Id</label><small><a href="https://help.mypurecloud.com/faq/how-do-i-find-my-organization-id/" target="_blank"> (How to find your orgId?)</a></small>
                <input type="text" required class="form-control" name="orgId" id="orgId" placeholder="Enter your PureCloud organization id (e.g. xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)" />
              </div>
              <div class="form-group">
                <label for="startDate">Start Date</label>
                <input data-provide="datepicker" required class="form-control" name="startDate" id="startDate" />
              </div>
              <div class="form-group">
                <label for="duration">Duration</label><small> (max = 7 days)</small>
                <input type="number" class="form-control" min="1" max="7" required name="duration" id="duration" value="1" />
              </div>
              <div class="form-group">
                <label for="emailAddress">Email Address</label>
                <input type="email" class="form-control" required name="emailAddress" id="emailAddress" placeholder="Enter your email address so we can let you know when the report is ready" />
              </div>
              <div class="float-right">
                <div id="error"><span class="text-danger"></span></div>
                <div id="success"><span class="text-success"></span></div>
                <span class="text-danger">Do not send multiple requests in a short time period as NewRelic has limitations</span>
                <button id="submitRequest" class="btn btn-primary">Submit Request</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- main content area end -->
    <!-- footer area start-->
    <footer>
      <div class="footer-area">
        <p>Â© Copyright Genesys 2019. All rights reserved.</p>
      </div>
    </footer>
    <!-- footer area end-->
  </div>
  <!-- page container area end -->

  <!-- jquery latest version -->
  <script src="assets/js/vendor/jquery-2.2.4.min.js"></script>

  <!-- bootstrap 4 js -->
  <script src="assets/js/popper.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script src="assets/js/owl.carousel.min.js"></script>
  <script src="assets/js/metisMenu.min.js"></script>
  <script src="assets/js/jquery.slimscroll.min.js"></script>
  <script src="assets/js/jquery.slicknav.min.js"></script>

  <!-- jQuery Toast -->
  <script src="assets/js/jquery.toast.min.js"></script>

  <!-- others plugins -->
  <script src="assets/js/plugins.js"></script>
  <script src="assets/js/scripts.js"></script>
  <script src="assets/js/bootstrap-datepicker.min.js"></script>

  <!-- This page's scripts -->
  <script src="assets/js/aws.js"></script>
  <script src="assets/js/notifications.js"></script>
  <script src="assets/js/mail.js"></script>
  <script src="assets/js/jquery.validate.min.js"></script>
  <script src="assets/js/additional-methods.min.js"></script>

  <script>
    // Init
    $("#pureCloudObjects").hide();

    $("#connectionform").validate({
      errorClass: "text-danger border border-danger",
      validClass: "",
      rules: {
        orgId: {
          required: true
        },
        emailAddress: {
          required: true,
          email: true
        }
      },
      invalidHandler: function (event, validator) {
        var errors = validator.numberOfInvalids();
        if (errors) {
          var message = errors == 1 ? "You missed 1 field. It has been highlighted" : "You missed " + errors + " fields. They have been highlighted";
          $("#connectionform #error span").html(message);
          console.error(message);
          $("#connectionform #error").show();
        }
      }
    });

    // Initialize DatePicker control (https://bootstrap-datepicker.readthedocs.io/en/latest/)
    $("#startDate").datepicker({
      format: "yyyy/mm/dd",
      endDate: "+0d", // No future dates
      autoclose: true, // Close after selecting date
      weekStart: 1 // weeks start on Mondays
    });

    // Generate a UUID
    function uuidv4() {
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
        var r = (Math.random() * 16) | 0,
          v = c == "x" ? r : (r & 0x3) | 0x8;
        return v.toString(16);
      });
    }

    // Submit Request Button
    $("#submitRequest").click(() => {
      event.preventDefault();

      $("#connectionform #success").hide();

      if ($("#connectionform").valid()) {
        // Clear errors
        $("#connectionform #error span").html("");
        $("#connectionform #error").hide();

        // Clear success message
        $("#connectionform #success span").html("");
        $("#connectionform #success").hide();

        var orgId = $("#orgId").val();
        var startDate = $("#startDate").val();
        var duration = $("#duration").val();
        var emailAddress = $("#emailAddress").val();
        var uuid = uuidv4();

        console.log("Submitting Request...");
        console.log(`org id: ${orgId}`);
        console.log(`start date: ${startDate}`);
        console.log(`duration: ${duration}`);
        console.log(`email address: ${emailAddress}`);
        console.log(`task id: ${uuid}`);

        submitRequest(orgId, startDate, duration, emailAddress, uuid)
          .then(token => {
            showMessage("Request submitted. Thank you!");
            sendEmail(
              emailAddress,
              "Your AE Upsell Task",
              "Thank you for using the AE Upsell tool. When ready, your data will be available here: https://pierricki3.github.io/eccctools/aeupsellrequests.html?taskId=" +
              uuid +
              "<br/>The data might not be available while the process is running. Please wait for a few minutes before hitting the Refresh button."
            )
              .then(response => {
                console.log("Email sent");
              })
              .catch(error => {
                showMessage("Failed to send email", true);
              });
            $("#connectionform #success span").html("Your request has been submitted. Please check your email for more details.");
            $("#connectionform #success").show();
          })
          .catch(error => {
            showMessage(error, true);
          });
      }
    });
  </script>

  <!-- Coollabs -->
  <script async defer src="https://cdn.coollabs.io/save.js"></script>

</body>

</html>